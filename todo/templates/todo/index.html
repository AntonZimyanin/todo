{% extends 'todo/layout.html' %}

{% block content %}

{% set user_id = user.id %}

<script>


var userId = user_id

document.querySelector('.ui.form').addEventListener('submit', function(event) {
    event.preventDefault();

    let title = event.target.elements.title.value;
    // let user = userId;

    let data = { title: title, user_id: userId };


    fetch(`{{ url_for('add') }}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(data => console.log('Success:', data))
    .catch((error) => console.error('Error:', error));
});
</script>


{% if is_admin == True %}
<p>You are admin</p>
{% endif %}
<div style="margin-top: 50px;" class="ui container">

    <h1 class="ui center aligned header green">{{ app_name }}</h1>

    <form class="ui form" action="{{ url_for('add') }}" method="post">
        <h3 class="test_css">Optimize your time with Python</h3>
        <div class="field">
            <label> "New task" </label>
            <input type="text" name="title" placeholder="Enter the name of the task" required><br>
        </div>
        <input type="hidden" name="user_id" value="{{ user.id }}">
        <button class="ui teal basic button" type="submit">Add</button>
    </form>
    

    {% for todo in todo_list %}
    <div class="ui segment">
        <p class="ui big header">â„–{{ todo.id }} {{ todo.title }}</p>

        {% if todo.is_complete == False %}
        <span class="ui gray label">Not completed</span>
        <a class="ui primary basic button" href="{{ url_for('update', todo_id=todo.id, is_complete=not todo.is_complete, user_id=user.id) }}">Close</a>
        {% else %}
        <span class="ui green label">Completed</span>
        <a class="ui blue button" href="{{ url_for('update', todo_id=todo.id, is_complete=not todo.is_complete, user_id=user.id) }}">Open</a>
        <a class="ui negative basic button" href="{{ url_for('delete', todo_id=todo.id, user_id=user.id) }}">Delete</a>
        {% endif %}
    </div>
    {% endfor %}


    <form class="ui form" action="{{ url_for('log_out') }}" method="post">
        
        <button class="ui teal basic button" type="submit">Log out</button>
    </form>
</div>
{% endblock content %}

